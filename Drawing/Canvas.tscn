[gd_scene load_steps=6 format=2]

[ext_resource path="res://Drawing/Canvas.gd" type="Script" id=1]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform sampler2D noise_texture;
uniform int bands = 6;

vec2 random(vec2 uv) {
	return vec2(fract(sin(dot(uv.xy,
		vec2(12.9898,78.233))) * 43758.5453123));
}

vec2 voronoi(vec2 uv, float columns, float rows) {
	
	vec2 index_uv = floor(vec2(uv.x * columns, uv.y * rows));
	vec2 fract_uv = fract(vec2(uv.x * columns, uv.y * rows));
	
	float minimum_dist = 1.0;  
	vec2 minimum_point;

	for (int y= -1; y <= 1; y++) {
		for (int x= -1; x <= 1; x++) {
			vec2 neighbor = vec2(float(x),float(y));
			vec2 point = random(index_uv + neighbor);

			vec2 diff = neighbor + point - fract_uv;
			float dist = length(diff);
			
			if(dist < minimum_dist) {
				minimum_dist = dist;
				minimum_point = point;
			}
		}
	}
	return minimum_point;
}

float get_band(vec2 uv) {
	float val = texture(noise_texture, uv).r;
	val *= float(bands);
	val = round(val);
	val /= float(bands);
	return val;
}

void fragment() {
	float val = get_band(SCREEN_UV+TIME*vec2(1.0, 0.0)*0.2);
	val *= get_band(SCREEN_UV+TIME*vec2(-1.0, 0.0)*0.3)*2.0;
	val *= get_band(SCREEN_UV+TIME*vec2(0.0, -1.0)*0.4)*1.5;
	val *= get_band(SCREEN_UV+TIME*vec2(0.0, 1.0)*0.5)*1.5;
	val *= 2.0;
	COLOR = vec4(val);
}"

[sub_resource type="OpenSimplexNoise" id=3]

[sub_resource type="NoiseTexture" id=4]
width = 256
height = 256
seamless = true
noise = SubResource( 3 )

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/bands = 6
shader_param/noise_texture = SubResource( 4 )

[node name="Canvas" type="Node2D"]
script = ExtResource( 1 )

[node name="Layers" type="Node2D" parent="."]

[node name="RemovedStack" type="Node2D" parent="."]
visible = false

[node name="Polygon2D" type="Polygon2D" parent="."]
material = SubResource( 2 )
invert_enable = true
invert_border = 21.4
polygon = PoolVector2Array( 0, 0, 0, 2048, 2048, 2048, 2048, 0 )
